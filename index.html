<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>Surpresaaaa</title>
<style>
html, body {
margin: 0; padding: 0;
width: 100vw; height: 100vh;
overflow: hidden;
background: url('https://www.motorlegend.com/modules/breve/photos/src/ferrari-250-23557-1-P.jpg') no-repeat center/cover;
font-family: Arial, sans-serif;
user-select: none;
touch-action: none;
}

.escala-wrapper {
position: absolute;
inset: 0;
display: none;
perspective: 1000px;
touch-action: none;
}

.cartao {
position: absolute;
transform-style: preserve-3d;
transition: transform 0.3s ease;
will-change: transform;
border-radius: 15px;
top: 0; left: 0;
}

.cartao img {
position: absolute;
width: 100%; height: 100%;
object-fit: contain;
border-radius: 15px;
backface-visibility: hidden;
}

.cartao .verso {
transform: rotateY(180deg);
}

#btnSair {
position: fixed;
bottom: 20px;
right: 20px;
padding: 10px 20px;
border-radius: 8px;
background: rgba(0,0,0,0.7);
color: white;
font-size: 1rem;
border: none;
display: none;
z-index: 10000;
}

#startScreen {
position: absolute;
inset: 0;
background: rgba(0,0,0,0.8);
color: white;
display: flex;
align-items: center;
justify-content: center;
font-size: 2rem;
z-index: 9999;
cursor: pointer;
text-align: center;
touch-action: none;
}

#tutorial {
position: fixed;
top: 10px;
right: 10px;
background: rgba(0,0,0,0.7);
color: white;
font-size: 0.9rem;
padding: 10px 12px;
border-radius: 8px;
z-index: 10001;
line-height: 1.4;
max-width: 200px;
text-align: left;
pointer-events: none;
}
</style>
</head>
<body>

<div id="startScreen">Clique para ver o Convite</div>

<div id="tutorial">
‚û§ Use 1 dedo para rotacionar o cart√£o<br>
‚û§ Use 2 dedos para dar zoom e mover o cart√£o<br>
</div>

<div class="escala-wrapper" id="escalaWrapper">
<div class="cartao" id="cartao">
<img class="frente" src="https://github.com/Vinicius-687/Safra1980/blob/main/1.png?raw=true" alt="Frente">
<img class="verso" src="https://i.imgur.com/5YBPbzs.png" alt="Verso">
</div>
</div>

<button id="btnSair">Sair</button>
<audio id="flipSound" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_8f7dbb4e3a.mp3?filename=flip-card-1.mp3"></audio>

<script>


    
    let docTitle = document.title;

    window.addEventListener("blur", () => {
      document.title = "Volte... ü•≤";
    });

    window.addEventListener("focus", () => {
      document.title = docTitle;
    });
const tutorial = document.getElementById('tutorial');
const startScreen = document.getElementById('startScreen');
const escalaWrapper = document.getElementById('escalaWrapper');
const cartao = document.getElementById('cartao');
const btnSair = document.getElementById('btnSair');
const flipSound = document.getElementById('flipSound');

let isFlipped = false;
let posX = 0, posY = 0, escalaZoom = 1;
let dragging = false;
let lastTouches = [];
let touchRotate = false;

let touchMoved = false;
let startX = 0;
let startY = 0;

function registerPointerDown(e) {
    touchMoved = false;
    startX = e.clientX;
    startY = e.clientY;
}


/* ---------- abrir convite (handler no mobile funciona corretamente) ---------- */
function abrirConvite() {
  // tenta fullscreen (catch para evitar erro em navegadores que bloqueiam)
  document.documentElement.requestFullscreen?.().catch(()=>{});
  startScreen.style.display = 'none';
  escalaWrapper.style.display = 'flex';
  btnSair.style.display = 'block';
  tutorial.style.display = 'block';
  ajustarDimensoesDoCartao();
  isFlipped = true;
  resetTransform(0,0);
  flipSound.currentTime = 0;
  flipSound.play();
}

/* pointer handlers para o startScreen (devem vir AP√ìS declara√ß√£o das constantes) */
startScreen.addEventListener('pointerdown', (e) => {
  // evita que o navegador interprete como gesto (scroll/zoom)
  e.preventDefault();
});
startScreen.addEventListener('pointerup', (e) => abrirConvite());

function resetTransform(rotateX = 0, rotateY = 0) {
const flip = isFlipped ? "rotateY(360deg)" : "rotateY(180deg)";
cartao.style.transform = `translate(${posX}px, ${posY}px) ${flip} scale(${escalaZoom}) rotateX(${rotateX}deg) rotateY(${rotateY}deg)`;
}

function atualizarTutorial() {
    if (btnSair.classList.contains("ativo")) { 
        tutorial.style.display = "flex"; 
    } else {
        tutorial.style.display = "none";
    }
}

// Sempre chame isso quando alterar o estado do bot√£o de sair
atualizarTutorial();

// Verifica se j√° foi visto
const jaViu = localStorage.getItem("tutorial_visto");

// Exibe somente se necess√°rio
if (!jaViu && btnSair.classList.contains("ativo")) {
    tutorial.style.display = "flex";
}

// Ao fechar o tutorial:
function fecharTutorial() {
    tutorial.style.display = "none";
    localStorage.setItem("tutorial_visto", "true");
}

function ajustarDimensoesDoCartao() {
const img = new Image();
img.onload = () => {
const maxW = window.innerWidth * 0.9;
const maxH = window.innerHeight * 0.9;
let w = img.width, h = img.height;
const ratio = w / h;
if (w > maxW) { w = maxW; h = w / ratio; }
if (h > maxH) { h = maxH; w = h * ratio; }
cartao.style.width = `${w}px`;
cartao.style.height = `${h}px`;
posX = (window.innerWidth - w) / 2;
posY = (window.innerHeight - h) / 2;
escalaZoom = 1;
escalaWrapper.style.display = 'block';
btnSair.style.display = 'block';
tutorial.style.display = 'block';
resetTransform();
};
img.src = cartao.querySelector('.frente').src;
}

/* ---------- touch handlers: 1 dedo move (se move), 1 dedo solta -> flip, 2 dedos -> zoom+pan ---------- */
/* === Pointer events unificados (PC mouse + primary touch move) === */
let pointerStartX = 0;
let pointerStartY = 0;
let pointerMoved = false;
let activePointerType = null;

escalaWrapper.addEventListener("pointerdown", (e) => {
    activePointerType = e.pointerType;
    pointerMoved = false;
    pointerStartX = e.clientX;
    pointerStartY = e.clientY;

    // bot√£o direito no PC ativa arraste com bot√£o direito
    if (e.pointerType === "mouse" && e.button === 2) {
        draggingRight = true;
        dragOffsetX = e.clientX - posX;
        dragOffsetY = e.clientY - posY;
        escalaWrapper.setPointerCapture(e.pointerId);
        e.preventDefault();
    }
});

escalaWrapper.addEventListener("pointermove", (e) => {
    // detecta movimento real
    if (Math.abs(e.clientX - pointerStartX) > 5 || Math.abs(e.clientY - pointerStartY) > 5) {
        pointerMoved = true;
    }

    // --- PC arraste com bot√£o direito ---
    if (draggingRight) {
        posX = e.clientX - dragOffsetX;
        posY = e.clientY - dragOffsetY;
        resetTransform();
        return;
    }

    // --- mobile primary touch: mover como cursor quando houver movimento ---
    if (activePointerType === "touch" && e.pointerType === "touch" && e.isPrimary && pointerMoved) {
        posX += (e.clientX - pointerStartX);
        posY += (e.clientY - pointerStartY);

        pointerStartX = e.clientX;
        pointerStartY = e.clientY;

        resetTransform();
        return;
    }

    // mouse move continua sendo usado para 3D tilt (n√£o aqui)
});

escalaWrapper.addEventListener("pointerup", (e) => {
    // bot√£o direito (PC) solta
    if (e.pointerType === "mouse" && e.button === 2) {
        draggingRight = false;
        try { escalaWrapper.releasePointerCapture(e.pointerId); } catch {}
        return;
    }

    // se n√£o houve movimento ‚Üí √© um toque curto -> flip
    if (!pointerMoved) {
        isFlipped = !isFlipped;
        resetTransform();
        flipSound.currentTime = 0;
        flipSound.play();
    }
});

/* ===================== MOBILE TOUCH FIXADO ===================== */

let pointerStartX = 0;
let pointerStartY = 0;
let pointerMoved = false;
let activePointerType = null;


/* === Mobile touch (1 dedo mover/tilt, 1 toque sem mover = flip, 2 dedos = zoom+pan) === */
let tStartX = 0, tStartY = 0;
let tMoved = false;
let tLastTouches = [];

function touchDist(touches) {
    return Math.hypot(touches[0].clientX - touches[1].clientX, touches[0].clientY - touches[1].clientY);
}

escalaWrapper.addEventListener("touchstart", (e) => {
    if (e.touches.length === 1) {
        tMoved = false;
        tStartX = e.touches[0].clientX;
        tStartY = e.touches[0].clientY;
    } else if (e.touches.length === 2) {
        tMoved = true; // impede flip enquanto houver multitouch
        tLastTouches = [...e.touches];
    }
}, { passive: false });

escalaWrapper.addEventListener("touchmove", (e) => {
    if (e.touches.length === 1) {
        const t = e.touches[0];
        const dx = t.clientX - tStartX;
        const dy = t.clientY - tStartY;

        if (Math.abs(dx) > 5 || Math.abs(dy) > 5) tMoved = true;

        // mover soft ‚Äî usa delta direto para comportar-se como cursor
        posX += dx;
        posY += dy;

        tStartX = t.clientX;
        tStartY = t.clientY;

        resetTransform();
        return;
    }

    if (e.touches.length === 2 && tLastTouches.length === 2) {
        const dNow = touchDist(e.touches);
        const dPrev = touchDist(tLastTouches);
        const delta = dNow - dPrev;

        escalaZoom += delta * 0.005;
        escalaZoom = Math.max(0.1, Math.min(escalaZoom, 5));

        const moveX = (e.touches[0].clientX + e.touches[1].clientX) - (tLastTouches[0].clientX + tLastTouches[1].clientX);
        const moveY = (e.touches[0].clientY + e.touches[1].clientY) - (tLastTouches[0].clientY + tLastTouches[1].clientY);

        posX += moveX * 0.5;
        posY += moveY * 0.5;

        tLastTouches = [...e.touches];
        resetTransform();
    }
}, { passive: false });

escalaWrapper.addEventListener("touchend", (e) => {
    // se ainda houver dedos, n√£o flipar
    if (e.touches.length > 0) return;

    // flip apenas se n√£o houve movimento (tap)
    if (!tMoved) {
        isFlipped = !isFlipped;
        resetTransform();
        flipSound.currentTime = 0;
        flipSound.play();
    }
});




// Zoom com scroll e pinch no PC
escalaWrapper.addEventListener('wheel', (e) => {
if (escalaWrapper.style.display !== 'block') return;
e.preventDefault();
const zoomStep = e.ctrlKey || Math.abs(e.deltaX) > 0 ? e.deltaY * -0.0025 : (e.deltaY < 0 ? 0.1 : -0.1);
escalaZoom += zoomStep;
escalaZoom = Math.max(0.1, Math.min(escalaZoom, 5));
resetTransform();
}, { passive: false });

// Efeito 3D com mouse
let targetRotX = 0;
let targetRotY = 0;
let currentRotX = 0;
let currentRotY = 0;
let animationRunning = false;

escalaWrapper.addEventListener('mousemove', (e) => {
    if (draggingRight || escalaWrapper.style.display !== 'block') return;

    const rect = cartao.getBoundingClientRect();

    const mouseX = e.clientX - rect.left;
    const mouseY = e.clientY - rect.top;

    const centerX = rect.width / 2;
    const centerY = rect.height / 2;

    let normX = (mouseX - centerX) / centerX;
    let normY = (mouseY - centerY) / centerY;

    const limit = 0.8;
    normX = Math.max(-limit, Math.min(limit, normX));
    normY = Math.max(-limit, Math.min(limit, normY));

    const maxTilt = 15;
    targetRotX = normY * maxTilt;
    targetRotY = normX * maxTilt;

    if (!animationRunning) animateRotation();
});

function animateRotation() {
    animationRunning = true;

    const smooth = 0.2; // Suavidade (0.05 ~ mais suave | 0.2 ~ mais r√°pido)

    currentRotX += (targetRotX - currentRotX) * smooth;
    currentRotY += (targetRotY - currentRotY) * smooth;

    resetTransform(currentRotX, currentRotY);

    if (Math.abs(targetRotX - currentRotX) > 0.2 || Math.abs(targetRotY - currentRotY) > 0.2) {
        requestAnimationFrame(animateRotation);
    } else {
        animationRunning = false;
    }
}

escalaWrapper.addEventListener('mouseleave', () => {
if (escalaWrapper.style.display === 'block') resetTransform();
});

let draggingRight = false;
let dragOffsetX = 0;
let dragOffsetY = 0;
let currentX = 0;
let currentY = 0;

const smooth = 0.2;

window.addEventListener('contextmenu', (e) => e.preventDefault());

startScreen.addEventListener("pointerdown", (e) => e.preventDefault());
startScreen.addEventListener("pointerup", (e) => {
    // apenas responde se n√£o houver sido movimento significativo
    if (Math.abs(e.clientX - startX) < 8 && Math.abs(e.clientY - startY) < 8) abrirConvite();
});
startScreen.addEventListener("pointerdown", registerPointerDown);


btnSair.addEventListener('click', () => {
        // sair do fullscreen caso esteja ativo
    if (document.fullscreenElement) {
        document.exitFullscreen();
    };
escalaWrapper.style.display = 'none';
btnSair.style.display = 'none';
tutorial.style.display = 'none';  // ‚Üê esconde o tutorial
startScreen.style.display = 'flex';
isFlipped = false;
});

document.addEventListener("fullscreenchange", () => {
    if (!document.fullscreenElement) {
        requestAnimationFrame(() => {
            requestAnimationFrame(() => {
                btnSair.click();
            });
        });
    }
});

window.addEventListener('load', () => {
    window.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' || e.code === 'Escape') {
            btnSair.click();
        }
    });
});

window.addEventListener('resize', () => {
if (escalaWrapper.style.display === 'block') ajustarDimensoesDoCartao();
});
</script>
</body>
</html>
