<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>Cartão Interativo</title>
  <style>
    html, body {
      margin: 0; padding: 0;
      width: 100vw; height: 100vh;
      overflow: hidden;
      background: url('https://www.motorlegend.com/modules/breve/photos/src/ferrari-250-23557-1-P.jpg') no-repeat center/cover;
      font-family: Arial, sans-serif;
      user-select: none;
      touch-action: manipulation;
    }

    .escala-wrapper {
      position: absolute;
      inset: 0;
      display: none;
      perspective: 1000px;
    }

    .cartao {
      position: absolute;
      transform-style: preserve-3d;
      transition: transform 0.3s ease;
      will-change: transform;
      border-radius: 15px;
      top: 0; left: 0;
    }

    .cartao img {
      position: absolute;
      width: 100%; height: 100%;
      object-fit: contain;
      border-radius: 15px;
      backface-visibility: hidden;
    }

    .cartao .verso {
      transform: rotateY(180deg);
    }

    #btnSair {
      position: fixed;
      bottom: 20px;
      right: 20px;
      padding: 10px 20px;
      border-radius: 8px;
      background: rgba(0,0,0,0.7);
      color: white;
      font-size: 1rem;
      border: none;
      display: none;
      z-index: 10000;
    }

    #startScreen {
      pointer-events: auto;
      touch-action: manipulation;
      position: absolute;
      inset: 0;
      background: rgba(0,0,0,0.8);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2rem;
      z-index: 9999;
      cursor: pointer;
      text-align: center;
    }

    #tutorial {
      position: fixed;
      top: 10px;
      right: 10px;
      background: rgba(0,0,0,0.7);
      color: white;
      font-size: 0.9rem;
      padding: 10px 12px;
      border-radius: 8px;
      z-index: 10001;
      line-height: 1.4;
      max-width: 200px;
      text-align: left;
      pointer-events: none;
    }
  </style>
</head>
<body>

  <div id="startScreen">Clique para ver o Convite</div>
  <div id="tutorial">➤ Toque no cartão para virar<br></div>

  <div class="escala-wrapper" id="escalaWrapper">
    <div class="cartao" id="cartao">
      <img class="frente" src="https://github.com/Vinicius-687/Safra1980/blob/main/1.png?raw=true" alt="Frente">
      <img class="verso" src="https://i.imgur.com/5YBPbzs.png" alt="Verso">
    </div>
  </div>

  <button id="btnSair">Sair</button>
  <audio id="flipSound" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_8f7dbb4e3a.mp3?filename=flip-card-1.mp3"></audio>

  <script>
    const startScreen = document.getElementById('startScreen');
    const escalaWrapper = document.getElementById('escalaWrapper');
    const cartao = document.getElementById('cartao');
    const btnSair = document.getElementById('btnSair');
    const flipSound = document.getElementById('flipSound');

    let isFlipped = false;
    let posX = 0, posY = 0, escalaZoom = 1;
    let lastTouches = [];
    let isPinch = false;

    function resetTransform(rotateX = 0, rotateY = 0) {
      const flip = isFlipped ? "rotateY(180deg)" : "rotateY(0deg)";
      cartao.style.transform = `translate(${posX}px, ${posY}px) ${flip} scale(${escalaZoom}) rotateX(${rotateX}deg) rotateY(${rotateY}deg)`;
    }

    function ajustarDimensoesDoCartao() {
      const img = new Image();
      img.onload = () => {
        const maxW = window.innerWidth * 0.9;
        const maxH = window.innerHeight * 0.9;
        let w = img.width, h = img.height;
        const ratio = w / h;
        if (w > maxW) { w = maxW; h = w / ratio; }
        if (h > maxH) { h = maxH; w = h * ratio; }
        cartao.style.width = `${w}px`;
        cartao.style.height = `${h}px`;
        posX = (window.innerWidth - w) / 2;
        posY = (window.innerHeight - h) / 2;
        escalaZoom = 1;
        escalaWrapper.style.display = 'block';
        btnSair.style.display = 'block';
        resetTransform();
      };
      img.src = cartao.querySelector('.frente').src;
    }

    escalaWrapper.addEventListener('touchstart', (e) => {
      if (e.touches.length === 2) {
        isPinch = true;
        lastTouches = [...e.touches];
      }
    }, { passive: false });

    escalaWrapper.addEventListener('touchmove', (e) => {
      if (isPinch && e.touches.length === 2) {
        e.preventDefault();
        const dx = e.touches[0].clientX - e.touches[1].clientX;
        const dy = e.touches[0].clientY - e.touches[1].clientY;
        const dist = Math.sqrt(dx * dx + dy * dy);

        const lastDx = lastTouches[0].clientX - lastTouches[1].clientX;
        const lastDy = lastTouches[0].clientY - lastTouches[1].clientY;
        const lastDist = Math.sqrt(lastDx * lastDx + lastDy * lastDy);

        const delta = dist - lastDist;
        escalaZoom += delta * 0.005;
        escalaZoom = Math.max(0.1, Math.min(escalaZoom, 5));
        resetTransform();
        lastTouches = [...e.touches];
      }
    }, { passive: false });

    escalaWrapper.addEventListener('touchend', (e) => {
      if (e.touches.length === 0 && e.changedTouches.length === 1) {
        isFlipped = !isFlipped;
        resetTransform();
        flipSound.currentTime = 0;
        flipSound.play();
      }
      isPinch = false;
    });

    escalaWrapper.addEventListener('wheel', (e) => {
      if (escalaWrapper.style.display !== 'block') return;
      e.preventDefault();
      const zoomStep = e.deltaY < 0 ? 0.1 : -0.1;
      escalaZoom += zoomStep;
      escalaZoom = Math.max(0.1, Math.min(escalaZoom, 5));
      resetTransform();
    }, { passive: false });

    escalaWrapper.addEventListener('click', () => {
      isFlipped = !isFlipped;
      resetTransform();
      flipSound.currentTime = 0;
      flipSound.play();
    });

    async function iniciarConvite() {
      try {
        await document.documentElement.requestFullscreen?.();
      } catch (e) {
        console.warn("Fullscreen falhou", e);
      }

      startScreen.style.display = 'none';

      const frente = cartao.querySelector('.frente');
      const img = new Image();
      img.src = frente.src;
      img.onload = () => {
        ajustarDimensoesDoCartao();
        isFlipped = true;
        resetTransform();
        flipSound.play();
      };
    }

    startScreen.addEventListener('click', iniciarConvite);
    startScreen.addEventListener('touchend', (e) => {
      e.preventDefault();
      e.stopPropagation();
      iniciarConvite();
    }, { passive: false });

    btnSair.addEventListener('click', () => {
      escalaWrapper.style.display = 'none';
      btnSair.style.display = 'none';
      startScreen.style.display = 'flex';
      isFlipped = false;
    });

    window.addEventListener('resize', () => {
      if (escalaWrapper.style.display === 'block') ajustarDimensoesDoCartao();
    });
  </script>
</body>
</html>
